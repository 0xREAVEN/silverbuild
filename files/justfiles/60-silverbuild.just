# ==================================================
# ğŸš€ SYSTEM & UPDATES
# ==================================================

# ğŸ”„ Met Ã  jour tout le systÃ¨me (OSTree, Flatpaks)
update:
    #!/usr/bin/bash
    echo "ğŸ”„ Mise Ã  jour de l'image systÃ¨me (OSTree)..."
    rpm-ostree upgrade
    echo "ğŸ“¦ Mise Ã  jour des Flatpaks..."
    flatpak update -y
    echo "âœ… Mise Ã  jour terminÃ©e ! N'oubliez pas de redÃ©marrer si l'image a changÃ©."

# ğŸ§¹ Nettoie le systÃ¨me en profondeur
clean:
    #!/usr/bin/bash
    echo "ğŸ—‘ï¸ Nettoyage des Flatpaks inutilisÃ©s..."
    flatpak uninstall --unused -y
    echo "ğŸ§¹ Nettoyage du cache systÃ¨me..."
    rpm-ostree cleanup -m -b
    echo "âœ… SystÃ¨me tout propre !"

setup-gsconnect:
    #!/usr/bin/bash
    set -euo pipefail
    echo -e "\033[1mConfiguration de GSConnect (Liaison Smartphone)\033[0m"
    read -p "Voulez-vous (O)uvrir ou (F)ermer les ports du pare-feu ? " choice
    case "$choice" in
        O|o)
            echo "ğŸ”“ Ouverture des ports pour GSConnect..."
            sudo firewall-cmd --permanent --add-service=kdeconnect
            sudo firewall-cmd --reload
            echo -e "âœ… \033[32mPorts ouverts ! Ton PC est maintenant visible par ton tÃ©lÃ©phone.\033[0m"
            ;;
        F|f)
            echo "ğŸ”’ Fermeture des ports pour GSConnect..."
            sudo firewall-cmd --permanent --remove-service=kdeconnect
            sudo firewall-cmd --reload
            echo -e "âŒ \033[31mPorts fermÃ©s. Ton PC est de nouveau invisible.\033[0m"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac

# ==================================================
# ğŸ® GAMING & AFFICHAGE
# ==================================================

# ğŸš€ Force l'upgrade FSR 4
toggle-fsr4:
    #!/usr/bin/bash
    set -euo pipefail
    FILE="$HOME/.config/environment.d/99-proton-fsr4.conf"
    echo -e "\033[1mGlobal FSR4 (RDNA4)\033[0m"
    echo "Permet Ã  Proton de forcer le FSR 4 sur les jeux compatibles (FSR 3.1+)."
    read -p "Voulez-vous (A)ctiver ou (D)Ã©sactiver ? " choice
    case "$choice" in
        A|a)
            mkdir -p "$HOME/.config/environment.d"
            echo "PROTON_FSR4_UPGRADE=1" > "$FILE"
            echo -e "âœ… \033[32mActivÃ©\033[0m: PROTON_FSR4_UPGRADE=1"
            ;;
        D|d)
            rm -f "$FILE"
            echo -e "âŒ \033[31mDÃ©sactivÃ©\033[0m: PROTON_FSR4_UPGRADE retirÃ©"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac

# â˜€ï¸ Configure le service Sunshine pour le streaming local (et ouvre les ports)
setup-sunshine:
    #!/usr/bin/bash
    set -euo pipefail
    echo -e "\033[1mConfiguration de Sunshine (Streaming Local)\033[0m"
    read -p "Voulez-vous (A)ctiver ou (D)Ã©sactiver le service en arriÃ¨re-plan ? " choice
    case "$choice" in
        A|a)
            echo "ğŸ”“ Ouverture des ports du pare-feu pour Sunshine..."
            sudo firewall-cmd --permanent --add-port=47984-47990/tcp
            sudo firewall-cmd --permanent --add-port=48010/tcp
            sudo firewall-cmd --permanent --add-port=47998-48000/udp
            sudo firewall-cmd --permanent --add-port=48002/udp
            sudo firewall-cmd --reload
            echo "ğŸš€ Activation du service Sunshine..."
            systemctl enable --user --now sunshine-kms.service
            echo -e "âœ… \033[32mSunshine est activÃ© et les ports sont ouverts !\033[0m"
            echo "ğŸ‘‰ Tu peux y accÃ©der via https://localhost:47990"
            ;;
        D|d)
            echo "ğŸ›‘ DÃ©sactivation du service Sunshine..."
            systemctl disable --user --now sunshine-kms.service
            echo "ğŸ”’ Fermeture des ports du pare-feu..."
            sudo firewall-cmd --permanent --remove-port=47984-47990/tcp
            sudo firewall-cmd --permanent --remove-port=48010/tcp
            sudo firewall-cmd --permanent --remove-port=47998-48000/udp
            sudo firewall-cmd --permanent --remove-port=48002/udp
            sudo firewall-cmd --reload
            echo -e "âŒ \033[31mSunshine est dÃ©sactivÃ© et les ports sont refermÃ©s.\033[0m"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac