# ==================================================
# ğŸš€ SYSTEM & UPDATES
# ==================================================

# Met Ã  jour tout le systÃ¨me (OSTree, Flatpaks)
update:
    #!/usr/bin/bash
    echo "ğŸ”„ Mise Ã  jour de l'image systÃ¨me (OSTree)..."
    rpm-ostree upgrade
    echo "ğŸ“¦ Mise Ã  jour des Flatpaks..."
    flatpak update -y
    echo "âœ… Mise Ã  jour terminÃ©e ! N'oubliez pas de redÃ©marrer si l'image a changÃ©."

# Ouverture et fermeture des ports pour GSConnect
setup-gsconnect:
    #!/usr/bin/bash
    set -euo pipefail
    echo -e "\033[1mConfiguration de GSConnect (Liaison Smartphone)\033[0m"
    read -p "Voulez-vous (O)uvrir ou (F)ermer les ports du pare-feu ? " choice
    case "$choice" in
        O|o)
            echo "ğŸ”“ Ouverture des ports pour GSConnect..."
            sudo firewall-cmd --permanent --add-service=kdeconnect
            sudo firewall-cmd --reload
            echo -e "âœ… \033[32mPorts ouverts ! Ton PC est maintenant visible par ton tÃ©lÃ©phone.\033[0m"
            ;;
        F|f)
            echo "ğŸ”’ Fermeture des ports pour GSConnect..."
            sudo firewall-cmd --permanent --remove-service=kdeconnect
            sudo firewall-cmd --reload
            echo -e "âŒ \033[31mPorts fermÃ©s. Ton PC est de nouveau invisible.\033[0m"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac

# Rend le dÃ©marrage 100% silencieux (Masque le texte et affiche le logo OEM)
setup-silent-boot:
    #!/usr/bin/bash
    set -euo pipefail
    echo "ğŸ¤« Configuration du dÃ©marrage silencieux..."
    
    # 1. On cache le menu GRUB (au cas oÃ¹ ce n'est pas fait)
    sudo grub2-editenv - set menu_auto_hide=1
    
    # 2. On rÃ©duit le temps d'attente fantÃ´me Ã  0
    sudo grub2-editenv - set timeout=0
    
    # 3. On ajoute les paramÃ¨tres de silence au noyau (sans casser l'image)
    echo "âš™ï¸ Ajout des paramÃ¨tres silencieux au noyau..."
    rpm-ostree kargs --append-if-missing=quiet --append-if-missing=rhgb --append-if-missing=rd.udev.log_level=3
    
    echo -e "âœ… \033[32mDÃ©marrage silencieux activÃ© !\033[0m"
    echo "âš ï¸ Comme on a modifiÃ© le noyau, il faut redÃ©marrer pour appliquer."

# Restaure les configurations par dÃ©faut du systÃ¨me (/etc/skel)
restore-skel:
    #!/usr/bin/bash
    set -euo pipefail
    echo -e "\033[1mRestauration du dossier personnel (/etc/skel)\033[0m"
    echo "Le dossier /etc/skel contient les fichiers de configuration par dÃ©faut du systÃ¨me (ex: .bashrc, .config...)."
    echo ""
    read -p "Voulez-vous (M)anquants (copier sans Ã©craser), (E)craser tout, ou (A)nnuler ? " choice
    case "$choice" in
        M|m)
            echo "ğŸ“ Copie uniquement des fichiers manquants..."
            cp -rn /etc/skel/. $HOME/
            echo -e "âœ… \033[32mFichiers manquants restaurÃ©s ! Tes configurations actuelles n'ont pas Ã©tÃ© touchÃ©es.\033[0m"
            ;;
        E|e)
            echo "âš ï¸ Copie et Ã©crasement des fichiers existants..."
            cp -r /etc/skel/. $HOME/
            echo -e "âœ… \033[32mDossier personnel rÃ©initialisÃ© avec les paramÃ¨tres par dÃ©faut !\033[0m"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac

# ==================================================
# ğŸ® GAMING & AFFICHAGE
# ==================================================

# Force l'upgrade FSR 4
toggle-fsr4:
    #!/usr/bin/bash
    set -euo pipefail
    FILE="$HOME/.config/environment.d/99-proton-fsr4.conf"
    echo -e "\033[1mGlobal FSR4 (RDNA4)\033[0m"
    echo "Permet Ã  Proton de forcer le FSR 4 sur les jeux compatibles (FSR 3.1+)."
    read -p "Voulez-vous (A)ctiver ou (D)Ã©sactiver ? " choice
    case "$choice" in
        A|a)
            mkdir -p "$HOME/.config/environment.d"
            echo "PROTON_FSR4_UPGRADE=1" > "$FILE"
            echo -e "âœ… \033[32mActivÃ©\033[0m: PROTON_FSR4_UPGRADE=1"
            ;;
        D|d)
            rm -f "$FILE"
            echo -e "âŒ \033[31mDÃ©sactivÃ©\033[0m: PROTON_FSR4_UPGRADE retirÃ©"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac

# Configure le service Sunshine pour le streaming local (et ouvre les ports)
setup-sunshine:
    #!/usr/bin/bash
    set -euo pipefail
    echo -e "\033[1mConfiguration de Sunshine (Streaming Local)\033[0m"
    read -p "Voulez-vous (A)ctiver ou (D)Ã©sactiver le service en arriÃ¨re-plan ? " choice
    case "$choice" in
        A|a)
            echo "ğŸ”“ Ouverture des ports du pare-feu pour Sunshine..."
            sudo firewall-cmd --permanent --add-port=47984-47990/tcp
            sudo firewall-cmd --permanent --add-port=48010/tcp
            sudo firewall-cmd --permanent --add-port=47998-48000/udp
            sudo firewall-cmd --permanent --add-port=48002/udp
            sudo firewall-cmd --reload
            echo "ğŸš€ Activation du service Sunshine..."
            systemctl enable --user --now sunshine-kms.service
            echo -e "âœ… \033[32mSunshine est activÃ© et les ports sont ouverts !\033[0m"
            echo "ğŸ‘‰ Tu peux y accÃ©der via https://localhost:47990"
            ;;
        D|d)
            echo "ğŸ›‘ DÃ©sactivation du service Sunshine..."
            systemctl disable --user --now sunshine-kms.service
            echo "ğŸ”’ Fermeture des ports du pare-feu..."
            sudo firewall-cmd --permanent --remove-port=47984-47990/tcp
            sudo firewall-cmd --permanent --remove-port=48010/tcp
            sudo firewall-cmd --permanent --remove-port=47998-48000/udp
            sudo firewall-cmd --permanent --remove-port=48002/udp
            sudo firewall-cmd --reload
            echo -e "âŒ \033[31mSunshine est dÃ©sactivÃ© et les ports sont refermÃ©s.\033[0m"
            ;;
        *) echo "Action annulÃ©e." ;;
    esac

# ==================================================
# ğŸº HOMEBREW & BBREW
# ==================================================

# Installe le wrapper bbrew
setup-brew:
    #!/usr/bin/bash
    set -euo pipefail

    echo "ğŸ“¦ Installation du dÃ©pÃ´t et du paquet bbrew..."
    brew install Valkyrie00/homebrew-bbrew/bbrew

    echo -e "\nğŸ‰ \033[32mInstallation terminÃ©e !\033[0m"
    echo "Ferme ce terminal et ouvres-en un nouveau pour utiliser la commande 'bbrew'."